{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _blockly = _interopRequireDefault(require(\"blockly\"));\n\nvar _debounce3 = _interopRequireDefault(require(\"./debounce\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction importFromXml(xml, workspace, onImportXmlError) {\n  try {\n    _blockly.default.Xml.domToWorkspace(_blockly.default.Xml.textToDom(xml), workspace);\n\n    return true;\n  } catch (e) {\n    if (onImportXmlError) {\n      onImportXmlError(e);\n    }\n\n    return false;\n  }\n}\n\nvar useBlocklyWorkspace = function useBlocklyWorkspace(_ref) {\n  var ref = _ref.ref,\n      initialXml = _ref.initialXml,\n      toolboxConfiguration = _ref.toolboxConfiguration,\n      workspaceConfiguration = _ref.workspaceConfiguration,\n      onWorkspaceChange = _ref.onWorkspaceChange,\n      onImportXmlError = _ref.onImportXmlError,\n      onInject = _ref.onInject,\n      onDispose = _ref.onDispose;\n\n  var _React$useState = _react.default.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      workspace = _React$useState2[0],\n      setWorkspace = _React$useState2[1];\n\n  var _React$useState3 = _react.default.useState(initialXml),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      xml = _React$useState4[0],\n      setXml = _React$useState4[1];\n\n  var _React$useState5 = _react.default.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      didInitialImport = _React$useState6[0],\n      setDidInitialImport = _React$useState6[1];\n\n  var _React$useState7 = _react.default.useState(false),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      didHandleNewWorkspace = _React$useState8[0],\n      setDidHandleNewWorkspace = _React$useState8[1]; // we explicitly don't want to recreate the workspace when the configuration changes\n  // so, we'll keep it in a ref and update as necessary in an effect hook\n\n\n  var workspaceConfigurationRef = _react.default.useRef(workspaceConfiguration);\n\n  _react.default.useEffect(function () {\n    workspaceConfigurationRef.current = workspaceConfiguration;\n  }, [workspaceConfiguration]);\n\n  var toolboxConfigurationRef = _react.default.useRef(toolboxConfiguration);\n\n  _react.default.useEffect(function () {\n    toolboxConfigurationRef.current = toolboxConfiguration;\n\n    if (toolboxConfiguration && workspace) {\n      workspace.updateToolbox(toolboxConfiguration);\n    }\n  }, [toolboxConfiguration, workspace]);\n\n  var onInjectRef = _react.default.useRef(onInject);\n\n  var onDisposeRef = _react.default.useRef(onDispose);\n\n  _react.default.useEffect(function () {\n    onInjectRef.current = onInject;\n  }, [onInject]);\n\n  _react.default.useEffect(function () {\n    onDisposeRef.current = onDispose;\n  }, [onDispose]);\n\n  var handleWorkspaceChanged = _react.default.useCallback(function (newWorkspace) {\n    if (onWorkspaceChange) {\n      onWorkspaceChange(newWorkspace);\n    }\n  }, [onWorkspaceChange]); // Workspace creation\n\n\n  _react.default.useEffect(function () {\n    var newWorkspace = _blockly.default.inject(ref.current, _objectSpread(_objectSpread({}, workspaceConfigurationRef.current), {}, {\n      toolbox: toolboxConfigurationRef.current\n    }));\n\n    setWorkspace(newWorkspace);\n    setDidInitialImport(false); // force a re-import if we recreate the workspace\n\n    setDidHandleNewWorkspace(false); // Singal that a workspace change event needs to be sent.\n\n    if (onInjectRef.current) {\n      onInjectRef.current(newWorkspace);\n    }\n\n    var onDisposeFunction = onDisposeRef.current; // Dispose of the workspace when our div ref goes away (Equivalent to didComponentUnmount)\n\n    return function () {\n      newWorkspace.dispose();\n\n      if (onDisposeFunction) {\n        onDisposeFunction(newWorkspace);\n      }\n    };\n  }, [ref]); // Send a workspace change event when the workspace is created\n\n\n  _react.default.useEffect(function () {\n    if (workspace && !didHandleNewWorkspace) {\n      handleWorkspaceChanged(workspace);\n    }\n  }, [handleWorkspaceChanged, didHandleNewWorkspace, workspace]); // Workspace change listener\n\n\n  _react.default.useEffect(function () {\n    if (workspace == null) {\n      return undefined;\n    }\n\n    var listener = function listener() {\n      handleWorkspaceChanged(workspace);\n    };\n\n    workspace.addChangeListener(listener);\n    return function () {\n      workspace.removeChangeListener(listener);\n    };\n  }, [workspace, handleWorkspaceChanged]); // xmlDidChange callback\n\n\n  _react.default.useEffect(function () {\n    if (workspace == null) {\n      return undefined;\n    }\n\n    var _debounce = (0, _debounce3.default)(function () {\n      var newXml = _blockly.default.Xml.domToText(_blockly.default.Xml.workspaceToDom(workspace));\n\n      if (newXml === xml) {\n        return;\n      }\n\n      setXml(newXml);\n    }, 200),\n        _debounce2 = _slicedToArray(_debounce, 2),\n        callback = _debounce2[0],\n        cancel = _debounce2[1];\n\n    workspace.addChangeListener(callback);\n    return function () {\n      workspace.removeChangeListener(callback);\n      cancel();\n    };\n  }, [workspace, xml]); // Initial Xml Changes\n\n\n  _react.default.useEffect(function () {\n    if (xml && workspace && !didInitialImport) {\n      var success = importFromXml(xml, workspace, onImportXmlError);\n\n      if (!success) {\n        setXml(null);\n      }\n\n      setDidInitialImport(true);\n    }\n  }, [xml, workspace, didInitialImport, onImportXmlError]);\n\n  return {\n    workspace: workspace,\n    xml: xml\n  };\n};\n\nvar _default = useBlocklyWorkspace;\nexports.default = _default;","map":{"version":3,"sources":["/Users/dhyeymavani/Documents/GitHub/r-block/node_modules/react-blockly/dist/useBlocklyWorkspace.js"],"names":["Object","defineProperty","exports","value","default","_react","_interopRequireDefault","require","_blockly","_debounce3","obj","__esModule","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","configurable","writable","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","TypeError","Symbol","iterator","prototype","toString","call","_arr","_n","_d","_e","undefined","_i","_s","next","done","err","Array","isArray","importFromXml","xml","workspace","onImportXmlError","Xml","domToWorkspace","textToDom","e","useBlocklyWorkspace","_ref","ref","initialXml","toolboxConfiguration","workspaceConfiguration","onWorkspaceChange","onInject","onDispose","_React$useState","useState","_React$useState2","setWorkspace","_React$useState3","_React$useState4","setXml","_React$useState5","_React$useState6","didInitialImport","setDidInitialImport","_React$useState7","_React$useState8","didHandleNewWorkspace","setDidHandleNewWorkspace","workspaceConfigurationRef","useRef","useEffect","current","toolboxConfigurationRef","updateToolbox","onInjectRef","onDisposeRef","handleWorkspaceChanged","useCallback","newWorkspace","inject","toolbox","onDisposeFunction","dispose","listener","addChangeListener","removeChangeListener","_debounce","newXml","domToText","workspaceToDom","_debounce2","callback","cancel","success","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _blockly = _interopRequireDefault(require(\"blockly\"));\n\nvar _debounce3 = _interopRequireDefault(require(\"./debounce\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction importFromXml(xml, workspace, onImportXmlError) {\n  try {\n    _blockly.default.Xml.domToWorkspace(_blockly.default.Xml.textToDom(xml), workspace);\n\n    return true;\n  } catch (e) {\n    if (onImportXmlError) {\n      onImportXmlError(e);\n    }\n\n    return false;\n  }\n}\n\nvar useBlocklyWorkspace = function useBlocklyWorkspace(_ref) {\n  var ref = _ref.ref,\n      initialXml = _ref.initialXml,\n      toolboxConfiguration = _ref.toolboxConfiguration,\n      workspaceConfiguration = _ref.workspaceConfiguration,\n      onWorkspaceChange = _ref.onWorkspaceChange,\n      onImportXmlError = _ref.onImportXmlError,\n      onInject = _ref.onInject,\n      onDispose = _ref.onDispose;\n\n  var _React$useState = _react.default.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      workspace = _React$useState2[0],\n      setWorkspace = _React$useState2[1];\n\n  var _React$useState3 = _react.default.useState(initialXml),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      xml = _React$useState4[0],\n      setXml = _React$useState4[1];\n\n  var _React$useState5 = _react.default.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      didInitialImport = _React$useState6[0],\n      setDidInitialImport = _React$useState6[1];\n\n  var _React$useState7 = _react.default.useState(false),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      didHandleNewWorkspace = _React$useState8[0],\n      setDidHandleNewWorkspace = _React$useState8[1]; // we explicitly don't want to recreate the workspace when the configuration changes\n  // so, we'll keep it in a ref and update as necessary in an effect hook\n\n\n  var workspaceConfigurationRef = _react.default.useRef(workspaceConfiguration);\n\n  _react.default.useEffect(function () {\n    workspaceConfigurationRef.current = workspaceConfiguration;\n  }, [workspaceConfiguration]);\n\n  var toolboxConfigurationRef = _react.default.useRef(toolboxConfiguration);\n\n  _react.default.useEffect(function () {\n    toolboxConfigurationRef.current = toolboxConfiguration;\n\n    if (toolboxConfiguration && workspace) {\n      workspace.updateToolbox(toolboxConfiguration);\n    }\n  }, [toolboxConfiguration, workspace]);\n\n  var onInjectRef = _react.default.useRef(onInject);\n\n  var onDisposeRef = _react.default.useRef(onDispose);\n\n  _react.default.useEffect(function () {\n    onInjectRef.current = onInject;\n  }, [onInject]);\n\n  _react.default.useEffect(function () {\n    onDisposeRef.current = onDispose;\n  }, [onDispose]);\n\n  var handleWorkspaceChanged = _react.default.useCallback(function (newWorkspace) {\n    if (onWorkspaceChange) {\n      onWorkspaceChange(newWorkspace);\n    }\n  }, [onWorkspaceChange]); // Workspace creation\n\n\n  _react.default.useEffect(function () {\n    var newWorkspace = _blockly.default.inject(ref.current, _objectSpread(_objectSpread({}, workspaceConfigurationRef.current), {}, {\n      toolbox: toolboxConfigurationRef.current\n    }));\n\n    setWorkspace(newWorkspace);\n    setDidInitialImport(false); // force a re-import if we recreate the workspace\n\n    setDidHandleNewWorkspace(false); // Singal that a workspace change event needs to be sent.\n\n    if (onInjectRef.current) {\n      onInjectRef.current(newWorkspace);\n    }\n\n    var onDisposeFunction = onDisposeRef.current; // Dispose of the workspace when our div ref goes away (Equivalent to didComponentUnmount)\n\n    return function () {\n      newWorkspace.dispose();\n\n      if (onDisposeFunction) {\n        onDisposeFunction(newWorkspace);\n      }\n    };\n  }, [ref]); // Send a workspace change event when the workspace is created\n\n\n  _react.default.useEffect(function () {\n    if (workspace && !didHandleNewWorkspace) {\n      handleWorkspaceChanged(workspace);\n    }\n  }, [handleWorkspaceChanged, didHandleNewWorkspace, workspace]); // Workspace change listener\n\n\n  _react.default.useEffect(function () {\n    if (workspace == null) {\n      return undefined;\n    }\n\n    var listener = function listener() {\n      handleWorkspaceChanged(workspace);\n    };\n\n    workspace.addChangeListener(listener);\n    return function () {\n      workspace.removeChangeListener(listener);\n    };\n  }, [workspace, handleWorkspaceChanged]); // xmlDidChange callback\n\n\n  _react.default.useEffect(function () {\n    if (workspace == null) {\n      return undefined;\n    }\n\n    var _debounce = (0, _debounce3.default)(function () {\n      var newXml = _blockly.default.Xml.domToText(_blockly.default.Xml.workspaceToDom(workspace));\n\n      if (newXml === xml) {\n        return;\n      }\n\n      setXml(newXml);\n    }, 200),\n        _debounce2 = _slicedToArray(_debounce, 2),\n        callback = _debounce2[0],\n        cancel = _debounce2[1];\n\n    workspace.addChangeListener(callback);\n    return function () {\n      workspace.removeChangeListener(callback);\n      cancel();\n    };\n  }, [workspace, xml]); // Initial Xml Changes\n\n\n  _react.default.useEffect(function () {\n    if (xml && workspace && !didInitialImport) {\n      var success = importFromXml(xml, workspace, onImportXmlError);\n\n      if (!success) {\n        setXml(null);\n      }\n\n      setDidInitialImport(true);\n    }\n  }, [xml, workspace, didInitialImport, onImportXmlError]);\n\n  return {\n    workspace: workspace,\n    xml: xml\n  };\n};\n\nvar _default = useBlocklyWorkspace;\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}